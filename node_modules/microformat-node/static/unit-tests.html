<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <title>Unit Tests - Microformats Shiv node.js Parser</title>
    <link rel="shortcut icon" href="http://microformatshiv.com/images/logo16.png" />
    <script src="//ajax.googleapis.com/ajax/libs/jquery/1.8.0/jquery.min.js"></script>

    <style>

      /* 1. RESET AND HTML5 SETTINGS 
      ------------------------------*/ 

      body,
      ul,
      ol,
      p,
      h1,
      h2,
      h3,
      h4,
      h5,
      h6,
      fieldset,
      dd {
        margin:  0;
        padding: 0;
      }

      article,
      aside,
      dialog,
      figure,
      figcaption,
      footer,
      header,
      hgroup,
      nav,
      section,
      small {
          display: block;
      }


      /* 2. BASE SETTINGS 
      --------------------------------------------*/

      html {
        background-color: #FFF;
        color: #444;
      }

      body {
        font-size: 100%;
        line-height: 1.4em;
        font-family: calibri, arial, helvetica, 'lucida grande', 'lucida sans unicode', verdana, sans-serif;
        border-top: 0.25em solid #444;
        padding: 3em;
      }

      h1{
        margin: 1em 0 1em 0;
        font-weight: normal;
      }

      input[type="text"]{
        width: 30em;
      }

      input[type="submit"]{
        margin-top: 1em;
        margin-left: 9em;
      }

      label{
        display: inline-block;
        width: 6em;
      }

      .notes {
        margin: 0 0 3em 0;
        font-weight: bold;
      }

      footer{
        margin: 4em 0 4em 0;
        color: #999;
      }

      a{
        color: #999;
      }


      table {
        width: 48em;
        margin: 1.5em 0;
        border: 0.0625em solid #EFEFEF;
      }

      tr {
        font-family: calibri, arial, helvetica, 'lucida grande', 'lucida sans unicode', verdana, sans-serif;
      }

      td {
        padding: 0.25em 0;
      }

      tbody tr:nth-child(even) {
        background-color: #EFEFEF;
      }

      th,
      tbody td {
        text-align: left;
        padding-left: 0.25em;
        margin: 0;
      }

      th {
        font-weight: normal;
        font-size: 1.333em;
        font-family: calibri, arial, helvetica, 'lucida grande', 'lucida sans unicode', verdana, sans-serif;
        background-color: #444;
        color: #FFF;
      }

      table caption {
        font-size: 0.75em;
        font-family: "Bliss ExtraLight", 'Gill Sans', 'Helvetica Neue', Arial, sans-serif; ;
        font-style: italic;
        text-align: left;
      }

      tfoot tr {
        font-size: 0.75em;
        font-family: calibri, arial, helvetica, 'lucida grande', 'lucida sans unicode', verdana, sans-serif;
        color: #AAA;
      }

      #tests{
        float: left;
        width: 25em;
        margin: 0 2em 0 0 ;
        cursor: pointer;
        list-style: none;
      }

      #results{
        width: 50em;
        float:left;
      }

      .failed{
        background-color: #302F2D;
        text-align: center;
        color: white;
        border-top: 1px solid white;
        width: 6em;
      }

      .passed{
        background-position: center center;
        text-align: center;
        border-top: 1px solid white;
        background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABMAAAANCAYAAABLjFUnAAAACXBIWXMAAAsTAAALEwEAmpwYAAAKT2lDQ1BQaG90b3Nob3AgSUNDIHByb2ZpbGUAAHjanVNnVFPpFj333vRCS4iAlEtvUhUIIFJCi4AUkSYqIQkQSoghodkVUcERRUUEG8igiAOOjoCMFVEsDIoK2AfkIaKOg6OIisr74Xuja9a89+bN/rXXPues852zzwfACAyWSDNRNYAMqUIeEeCDx8TG4eQuQIEKJHAAEAizZCFz/SMBAPh+PDwrIsAHvgABeNMLCADATZvAMByH/w/qQplcAYCEAcB0kThLCIAUAEB6jkKmAEBGAYCdmCZTAKAEAGDLY2LjAFAtAGAnf+bTAICd+Jl7AQBblCEVAaCRACATZYhEAGg7AKzPVopFAFgwABRmS8Q5ANgtADBJV2ZIALC3AMDOEAuyAAgMADBRiIUpAAR7AGDIIyN4AISZABRG8lc88SuuEOcqAAB4mbI8uSQ5RYFbCC1xB1dXLh4ozkkXKxQ2YQJhmkAuwnmZGTKBNA/g88wAAKCRFRHgg/P9eM4Ors7ONo62Dl8t6r8G/yJiYuP+5c+rcEAAAOF0ftH+LC+zGoA7BoBt/qIl7gRoXgugdfeLZrIPQLUAoOnaV/Nw+H48PEWhkLnZ2eXk5NhKxEJbYcpXff5nwl/AV/1s+X48/Pf14L7iJIEyXYFHBPjgwsz0TKUcz5IJhGLc5o9H/LcL//wd0yLESWK5WCoU41EScY5EmozzMqUiiUKSKcUl0v9k4t8s+wM+3zUAsGo+AXuRLahdYwP2SycQWHTA4vcAAPK7b8HUKAgDgGiD4c93/+8//UegJQCAZkmScQAAXkQkLlTKsz/HCAAARKCBKrBBG/TBGCzABhzBBdzBC/xgNoRCJMTCQhBCCmSAHHJgKayCQiiGzbAdKmAv1EAdNMBRaIaTcA4uwlW4Dj1wD/phCJ7BKLyBCQRByAgTYSHaiAFiilgjjggXmYX4IcFIBBKLJCDJiBRRIkuRNUgxUopUIFVIHfI9cgI5h1xGupE7yAAygvyGvEcxlIGyUT3UDLVDuag3GoRGogvQZHQxmo8WoJvQcrQaPYw2oefQq2gP2o8+Q8cwwOgYBzPEbDAuxsNCsTgsCZNjy7EirAyrxhqwVqwDu4n1Y8+xdwQSgUXACTYEd0IgYR5BSFhMWE7YSKggHCQ0EdoJNwkDhFHCJyKTqEu0JroR+cQYYjIxh1hILCPWEo8TLxB7iEPENyQSiUMyJ7mQAkmxpFTSEtJG0m5SI+ksqZs0SBojk8naZGuyBzmULCAryIXkneTD5DPkG+Qh8lsKnWJAcaT4U+IoUspqShnlEOU05QZlmDJBVaOaUt2ooVQRNY9aQq2htlKvUYeoEzR1mjnNgxZJS6WtopXTGmgXaPdpr+h0uhHdlR5Ol9BX0svpR+iX6AP0dwwNhhWDx4hnKBmbGAcYZxl3GK+YTKYZ04sZx1QwNzHrmOeZD5lvVVgqtip8FZHKCpVKlSaVGyovVKmqpqreqgtV81XLVI+pXlN9rkZVM1PjqQnUlqtVqp1Q61MbU2epO6iHqmeob1Q/pH5Z/YkGWcNMw09DpFGgsV/jvMYgC2MZs3gsIWsNq4Z1gTXEJrHN2Xx2KruY/R27iz2qqaE5QzNKM1ezUvOUZj8H45hx+Jx0TgnnKKeX836K3hTvKeIpG6Y0TLkxZVxrqpaXllirSKtRq0frvTau7aedpr1Fu1n7gQ5Bx0onXCdHZ4/OBZ3nU9lT3acKpxZNPTr1ri6qa6UbobtEd79up+6Ynr5egJ5Mb6feeb3n+hx9L/1U/W36p/VHDFgGswwkBtsMzhg8xTVxbzwdL8fb8VFDXcNAQ6VhlWGX4YSRudE8o9VGjUYPjGnGXOMk423GbcajJgYmISZLTepN7ppSTbmmKaY7TDtMx83MzaLN1pk1mz0x1zLnm+eb15vft2BaeFostqi2uGVJsuRaplnutrxuhVo5WaVYVVpds0atna0l1rutu6cRp7lOk06rntZnw7Dxtsm2qbcZsOXYBtuutm22fWFnYhdnt8Wuw+6TvZN9un2N/T0HDYfZDqsdWh1+c7RyFDpWOt6azpzuP33F9JbpL2dYzxDP2DPjthPLKcRpnVOb00dnF2e5c4PziIuJS4LLLpc+Lpsbxt3IveRKdPVxXeF60vWdm7Obwu2o26/uNu5p7ofcn8w0nymeWTNz0MPIQ+BR5dE/C5+VMGvfrH5PQ0+BZ7XnIy9jL5FXrdewt6V3qvdh7xc+9j5yn+M+4zw33jLeWV/MN8C3yLfLT8Nvnl+F30N/I/9k/3r/0QCngCUBZwOJgUGBWwL7+Hp8Ib+OPzrbZfay2e1BjKC5QRVBj4KtguXBrSFoyOyQrSH355jOkc5pDoVQfujW0Adh5mGLw34MJ4WHhVeGP45wiFga0TGXNXfR3ENz30T6RJZE3ptnMU85ry1KNSo+qi5qPNo3ujS6P8YuZlnM1VidWElsSxw5LiquNm5svt/87fOH4p3iC+N7F5gvyF1weaHOwvSFpxapLhIsOpZATIhOOJTwQRAqqBaMJfITdyWOCnnCHcJnIi/RNtGI2ENcKh5O8kgqTXqS7JG8NXkkxTOlLOW5hCepkLxMDUzdmzqeFpp2IG0yPTq9MYOSkZBxQqohTZO2Z+pn5mZ2y6xlhbL+xW6Lty8elQfJa7OQrAVZLQq2QqboVFoo1yoHsmdlV2a/zYnKOZarnivN7cyzytuQN5zvn//tEsIS4ZK2pYZLVy0dWOa9rGo5sjxxedsK4xUFK4ZWBqw8uIq2Km3VT6vtV5eufr0mek1rgV7ByoLBtQFr6wtVCuWFfevc1+1dT1gvWd+1YfqGnRs+FYmKrhTbF5cVf9go3HjlG4dvyr+Z3JS0qavEuWTPZtJm6ebeLZ5bDpaql+aXDm4N2dq0Dd9WtO319kXbL5fNKNu7g7ZDuaO/PLi8ZafJzs07P1SkVPRU+lQ27tLdtWHX+G7R7ht7vPY07NXbW7z3/T7JvttVAVVN1WbVZftJ+7P3P66Jqun4lvttXa1ObXHtxwPSA/0HIw6217nU1R3SPVRSj9Yr60cOxx++/p3vdy0NNg1VjZzG4iNwRHnk6fcJ3/ceDTradox7rOEH0x92HWcdL2pCmvKaRptTmvtbYlu6T8w+0dbq3nr8R9sfD5w0PFl5SvNUyWna6YLTk2fyz4ydlZ19fi753GDborZ752PO32oPb++6EHTh0kX/i+c7vDvOXPK4dPKy2+UTV7hXmq86X23qdOo8/pPTT8e7nLuarrlca7nuer21e2b36RueN87d9L158Rb/1tWeOT3dvfN6b/fF9/XfFt1+cif9zsu72Xcn7q28T7xf9EDtQdlD3YfVP1v+3Njv3H9qwHeg89HcR/cGhYPP/pH1jw9DBY+Zj8uGDYbrnjg+OTniP3L96fynQ89kzyaeF/6i/suuFxYvfvjV69fO0ZjRoZfyl5O/bXyl/erA6xmv28bCxh6+yXgzMV70VvvtwXfcdx3vo98PT+R8IH8o/2j5sfVT0Kf7kxmTk/8EA5jz/GMzLdsAAAAgY0hSTQAAeiUAAICDAAD5/wAAgOkAAHUwAADqYAAAOpgAABdvkl/FRgAAANhJREFUeNqk0r9KwlEUAOAvLQiy1qhoqUGovSF7gl6jV4iGegEdXCMadHVwDgpyEyKjNwiRxh5AwciWS9jl+u/ngTvdc79zLufkZY8d3GEXr0s49vCMEX5wiY2sUCtA4+diUWgbTwnoAcfjietYmQId4DEBNUORf603cDMBOsJbAqqFJv5iP7Q5wjeuI6iIzgSoEFetRklDXIW7Q7wkoDq2Ul84x2eUPMAt2gnoHpvTpnSCj8TD+FSQm2fsp+jOgNYW2aMSegmoitUsG36Gd/TxhTLy8zz8HQB6MlUy5XcgygAAAABJRU5ErkJggg%3D%3D');
        background-repeat: no-repeat;
        text-indent: -9999px;
        width: 6em;
      }

      footer{
        clear: both;
      }

      .clearfix:after {
        visibility: hidden;
        display: block;
        font-size: 0;
        content: " ";
        clear: both;
        height: 0;
        }
      * html .clearfix             { zoom: 1; } /* IE6 */
      *:first-child+html .clearfix { zoom: 1; } /* IE7 */


    </style>


    <script>

      var results = new Array();

      $(document).ready(function() {

        var testSuites = [
          'http://www.ufxtract.com/testsuite/hcard/default.htm',
          'http://www.ufxtract.com/testsuite/hcalendar/default.htm',
          'http://www.ufxtract.com/testsuite/hresume/default.htm',
          //'http://www.ufxtract.com/testsuite/hrecipe/default.htm',
          'http://www.ufxtract.com/testsuite/geo/default.htm'
        ]

        var testFixtures = [
          'http://microformats.org/wiki/value-dt-test-YYYY-MM-DD--HH-MM',
          'http://microformats.org/wiki/value-dt-test-abbr-YYYY-MM-DD--HH-MM',
          'http://microformats.org/wiki/value-dt-test-abbr-YYYY-MM-DD-abbr-HH-MM',
          'http://microformats.org/wiki/value-dt-test-YYYY-MM-DD--HHpm',
          'http://microformats.org/wiki/value-dt-test-YYYY-MM-DD--Hpm-EEpm',
          'http://microformats.org/wiki/value-dt-test-YYYY-MM-DD--abbr-HH-MMpm',
          'http://microformats.org/wiki/value-dt-test-YYYY-MM-DD--12am-12pm',
          'http://microformats.org/wiki/value-dt-test-YYYY-MM-DD--H-MMam-Epm',
          'http://microformats.org/wiki/value-dt-test-YYYY-MM-DD--0Ham-EEam',
          'http://microformats.org/wiki/value-dt-test-YYYY-MM-DD--H-MM-SSpm-EE-NN-UUpm',
          'http://microformats.org/wiki/value-dt-test-YYYY-DDD--HH-MM-SS',
          'http://microformats.org/wiki/value-dt-test-YYYY-MM-DD--HH-MMZ-EE-NN-UUZ',
          'http://microformats.org/wiki/value-dt-test-YYYY-MM-DD--HH-MM-XX-YY--EE-NN-UU--XXYY',
          'http://microformats.org/wiki/value-dt-test-YYYY-MM-DD--HH-MM-XX--EE-NN-UU--Y',
          'http://microformats.org/wiki/value-dt-test-YYYY-MM-DD--HH-MM-SS-XXYY--EE-NN--Z'
        ]

        for (var y = 0; y < testSuites.length; y++) {
          $.getJSON('../?url=' + encodeURIComponent(testSuites[y]) + '&format=test-suite', function(data) {
            if(data.microformats['test-suite']){

              var testSuite = data.microformats['test-suite'];
              for (var key in testSuite) {
                if (!testSuite.hasOwnProperty(key))
                  continue;  // skip this 
                                  
                var item = testSuite[key];
                var i = item.test.length;
                var x = 0;
                while (x < i) {
                    $('<li data-url="'+ item.test[x].url +'">' + item.test[x].format + ' - ' + item.test[x].description +'</li>').appendTo('#tests').click(function(e){
                        $('#tests li').removeClass('hilight');
                        $(this).addClass('hilight');
                        loadTestFixture($(this).attr('data-url'))
                    })
                    x++;
                }
              }
            }
          });
        }

        //// the wiki test suite needs some more work before it can be tested against
        // for (var z = 0; z < testFixtures.length; z++) {
        //   $('<li data-url="'+ testFixtures[z] +'">' + testFixtures[z].replace('http://microformats.org/wiki/','')  +'</li>').appendTo('#tests').click(function(e){
        //     $('#tests li').removeClass('hilight');
        //     $(this).addClass('hilight');
        //     loadTestFixture($(this).attr('data-url'))
        //   })
        // }

      });


      function loadTestFixture(url){
        $.getJSON('../?url=' + encodeURIComponent(url) + '&callback=?', function(data) {
          loadTestData(url, data);
        });
      }


      function loadTestData(url,data){
        $.getJSON('../?url=' + encodeURIComponent(url + '#uf') + '&callback=?', function(ufData) {
          var testFixture = data.microformats['test-fixture'];

          if(testFixture.length > 0){
            if(data.microformats['test-fixture'][0].assert){
              var asserts = data.microformats['test-fixture'][0].assert;
              var table = addResultTable(data.microformats['test-fixture'][0].summary, url, ufData.microformats );
              runTests(asserts, ufData.microformats, table);
            }
          }else{
            alert('No test found')
          }
          
        });

      }


      function runTests(asserts, microformats, table){

        for (var i = 0; i < asserts.length; i++) {

          var test = asserts[i].test;
          var result = asserts[i].result;
          var comment = asserts[i].comment;
          var testStatus = "none";
          pageNumber = 1
          resuult = {};

          if (result.indexOf("IsEqualTo(") > -1) {
              result = new Result(pageNumber, i, asserts[i], isEqualTo(test, result, comment, microformats));
          }
          else if (result.indexOf("IsEqualToCaseInsensitive(") > -1) {
              result = new Result(pageNumber, i, asserts[i], isEqualToCaseInsensitive(test, result, comment, microformats));
          }
          else if (result.indexOf("IsEqualToISODate(") > -1) {
              result = new Result(pageNumber, i, asserts[i], isEqualToISODate(test, result, comment, microformats));
          }
          else if (result.indexOf("IsEqualToGeo(") > -1) {
              result = new Result(pageNumber, i, asserts[i], isEqualToGeo(test, result, comment, microformats));
          }
          else if (result.indexOf("IsEqualToPhoneNumber(") > -1) {
              result = new Result(pageNumber, i, asserts[i], isEqualToPhoneNumber(test, result, comment, microformats));
          }
          else if (result.indexOf("IsTrue()") > -1) {
              result = new Result(pageNumber, i, asserts[i], isTrue(test, result, comment, microformats));
          }
          else if (result.indexOf("IsFalse()") > -1) {
              result = new Result(pageNumber, i, asserts[i], isFalse(test, result, comment, microformats));
          }
          else if (result.indexOf("HasProperty(") > -1) {
              result = new Result(pageNumber, i, asserts[i], HasProperty(test, result, comment, microformats));
          }
          else {
              result = new Result(pageNumber, i, asserts[i], 'unnone');
          }

          results.push(result)
          addResult(result, table);

        }
      }


      function addResultTable(title, url, microformats){
        $('#results').empty();
          $('#results').append('<h2>' + title + '</h2>');
          $('#results').append('<p><a href="' + url +'">Test page address: ' + url + '</a></p>');
          var table = $('<table></table>').appendTo('#results');
          $('#results').append('<pre><code>' + js_beautify(JSON.stringify(microformats)) + '</code></pre>');
          return table;
      }


      function addResult(result, table){
          $(table).append('<tr title="' + result.assert.comment + '"><td class="' + result.testStatus + '">' + result.testStatus + '</td><td>' + result.assert.test + '</td><td>' + result.assert.result + '</td></tr>')
      }



      // The "isEqualTo" tester
      isEqualTo = function (test, result, comment, microformats) {
          resultValue = result.substring(11, result.length - 2)
          testValue = String(getNodeVaue(test, microformats));
          if (testValue != '' && resultValue == testValue)
              return "passed";
          else
              return "failed";
      }

      // The "isEqualToCaseInsensitive" tester
      isEqualToCaseInsensitive = function (test, result, comment, microformats) {
          resultValue = result.substring(26, result.length - 2)
          testValue = String(getNodeVaue(test, microformats));
          if (testValue != '' && resultValue.toLowerCase() == testValue.toLowerCase())
              return "passed";
          else
              return "failed";
      }

      // The "isEqualToISODate" tester
      isEqualToISODate = function (test, result, comment, microformats) {
          output = "failed"
          resultValue = String(result.substring(18, result.length - 2));
          testValue = String(getNodeVaue(test, microformats));
          if (testValue != '' && resultValue.toLowerCase() == testValue.toLowerCase()) {
              output = "passed";
          } else {
              if (CompareISODates(testValue, resultValue))
                  output = "passed";
          }
          return output;
      }

      // The "isEqualToGeo" tester
      isEqualToGeo = function (test, result, comment, microformats) {
          output = "failed"
          resultValue = String(result.substring(14, result.length - 2));
          testValue = String(getNodeVaue(test, microformats));
          if (testValue != '' && resultValue.toLowerCase() == testValue.toLowerCase()) {
              output = "passed";
          } else {
              if (CompareRFC2426Geo(testValue, resultValue))
                  output = "passed";
          }
          return output;
      }


      // The "isEqualToPhoneNumber" tester
      isEqualToPhoneNumber = function (test, result, comment, microformats) {
          output = "failed"
          resultValue = result.substring(22, result.length - 2)
          testValue = String(getNodeVaue(test, microformats));

          if (testValue != '' && resultValue.toLowerCase() == testValue.toLowerCase()) {
              output = "passed";
          } else {
              if (ComparePhoneNumbers(testValue, resultValue))
                  output = "passed";
          }
          return output;
      }


      // The "isTrue" tester
      isTrue = function (test, result, comment, microformats) {
          testValue = getNodeVaue(test, microformats);
          if (typeof (testValue) != 'undefined' && String(testValue.toLowerCase()) == 'true')
              return "passed";
          else
              return "failed";
      }

      // The "isFalse" tester
      isFalse = function (test, result, comment, microformats) {
          testValue = getNodeVaue(test, microformats);
          if (typeof (testValue) != 'undefined' && String(testValue.toLowerCase()) == 'false')
              return "passed";
          else
              return "failed";
      }

      // The "HasProperty" tester
      HasProperty = function (test, result, comment, microformats) {

          var testValue = getNodeVaue(test, microformats);
          var resultValue = result.substring(12, result.length - 1).toLowerCase();
          var output = "failed";


          var nodeHasProperty = true;
          if (testValue == 'undefined' || testValue == null)
              nodeHasProperty = false;

          if (nodeHasProperty == true && resultValue == "true")
              output = "passed";

          if (nodeHasProperty == false && resultValue == 'false')
              output = "passed";

          return output;
      }

      // A helper function to finds a value of a given JSON property
      getNodeVaue = function (test, microformats) {
          // Gets a value from a JSON object
          // vcard[0].url[0]
          var output = null;
          try {
              var arrayDots = test.split(".");
              for (var i = 0; i < arrayDots.length; i++) {
                  if (arrayDots[i].indexOf('[') > -1) {
                      // Reconstructs and adds access to array of objects
                      var arrayAB = arrayDots[i].split("[");
                      var arrayName = arrayAB[0];
                      var arrayPosition = Number(arrayAB[1].substring(0, arrayAB[1].length - 1));

                      if (microformats[arrayName] != null || microformats[arrayName] != 'undefined') {
                          if (microformats[arrayName][arrayPosition] != null || microformats[arrayName][arrayPosition] != 'undefined')
                              microformats = microformats[arrayName][arrayPosition];

                      }
                      else {
                          currentObject = null;
                      }

                  }
                  else {
                      // Adds access to a property using property array ["given-name"]
                      if (microformats[arrayDots[i]] != null || microformats[arrayDots[i]] != 'undefined')
                          microformats = microformats[arrayDots[i]];
                  }
              }
              output = microformats;
          } catch (err) {
              // Add error capture
              output = null;
          }
          return output;
      }



      // Simple result storage object used by ParserInterface
      function Result(pageNumber, assertNumber, assert, testStatus) {
          this.pageNumber = pageNumber;
          this.assertNumber = assertNumber;
          this.assert = assert; // object with properties
          this.testStatus = testStatus;
      }

      // Is an object a array
      function isArray(obj) {
          return obj && !(obj.propertyIsEnumerable('length')) 
              && typeof obj === 'object' 
              && typeof obj.length === 'number';
      };


function ISODate(){this.dY;this.dM=-1;this.dD=-1;this.z=false;this.tH;this.tM=-1;this.tS=-1;this.tD=-1;this.tzH;this.tzM=-1;this.tzPN="+";this.z=false;this.format="W3C";if(arguments[0])this.Parse(arguments[0])}function CompareISODates(a,b){var c=(new ISODate(a)).toString().replace(/:00/g,"");var d=(new ISODate(b)).toString().replace(/:00/g,"");if(c==""&&d==""){return false}else{if(c==d)return true;else return false}}function PhoneNumber(){this.raw="";this.canonicalisation="";if(arguments[0])this.Parse(arguments[0])}function ComparePhoneNumbers(a,b){var c=(new PhoneNumber(a)).toString();var d=(new PhoneNumber(b)).toString();if(c==""&&d==""){return false}else{if(c==d)return true;else return false}}function RFC2426Geo(){this.latitude=0;this.longitude=0;if(arguments[0])this.Parse(arguments[0])}function CompareRFC2426Geo(a,b){var c=(new RFC2426Geo(a)).toString();var d=(new RFC2426Geo(b)).toString();if(c==""&&d==""){return false}else{if(c==d)return true;else return false}}ISODate.prototype.Parse=function(a){var b="",c;var d="",e="",f="";a=a.toUpperCase();if(a.indexOf("T")>-1){c=a.split("T");d=c[0];e=c[1];if(e.indexOf("Z")>-1||e.indexOf("+")>-1||e.indexOf("-")>-1){var g=e.split("Z");e=g[0];f=g[1];this.z=true;if(e.indexOf("+")>-1||e.indexOf("-")>-1){var h=0;if(e.indexOf("+")>-1)h=e.indexOf("+");else h=e.indexOf("-");f=e.substring(h,e.length);e=e.substring(0,h)}}}else{d=a}if(d!=""){this.ParseDate(d);if(e!=""){this.ParseTime(e);if(f!=""){this.ParseTimeZone(f)}}}};ISODate.prototype.ParseDate=function(a){var b="",c;c=a.match(/(\d\d\d\d)?-?(\d\d)?-?(\d\d)?/);if(c[1]){this.dY=c[1]}if(c[2]){this.dM=c[2]}if(c[3]){this.dD=c[3]}};ISODate.prototype.ParseTime=function(a){var b="";var c=a.match(/(\d\d)?:?(\d\d)?:?(\d\d)?.?([0-9]+)?/);timeSegment=a;if(c[1]){this.tH=c[1]}if(c[2]){this.tM=c[2]}if(c[3]){this.tS=c[3]}if(c[4]){this.tD=c[4]}};ISODate.prototype.ParseTimeZone=function(a){var b="";var c=a.match(/([-+]{1})?(\d\d)?:?(\d\d)?/);if(c[1]){this.tzPN=c[1]}if(c[2]){this.tzH=c[2]}if(c[3]){this.tzM=c[3]}};ISODate.prototype.toString=function(){if(this.format=="W3C"){dsep="-";tsep=":"}if(this.format=="RFC3339"){dsep="";tsep=""}var a="";if(typeof this.dY!="undefined"){a=this.dY;if(this.dM>0&&this.dM<13){a+=dsep+this.dM;if(this.dD>0&&this.dD<32){a+=dsep+this.dD;if(typeof this.tH!="undefined"){if(this.tH>-1&&this.tH<25){a+="T"+this.tH;if(this.tM>-1&&this.tM<61){a+=tsep+this.tM;if(this.tS>-1&&this.tS<61){a+=tsep+this.tS;if(this.tD>-1)a+="."+this.tD}}if(this.z){a+="Z"}if(typeof this.tzH!="undefined"){if(this.tzH>-1&&this.tzH<25){a+=this.tzPN+this.tzH;if(this.tzM>-1&&this.tzM<61)a+=tsep+this.tzM}}}}}}}return a};PhoneNumber.prototype.Reset=function(){this.raw="";this.canonicalisation=""};PhoneNumber.prototype.Parse=function(a){this.Reset();this.raw=a;a=a.replace(" ","");var b;b=a.match(/[0-9\+]/g);if(isArray(b)){if(isArray(b)){for(var c=0;c<b.length;c++){this.canonicalisation+=b[c]}}}};PhoneNumber.prototype.toString=function(){return this.canonicalisation};RFC2426Geo.prototype.Parse=function(a){this.Reset();if(a.indexOf(";")>0){parts=a.split(";");this.latitude=parseFloat(parts[0]).toFixed(6);this.longitude=parseFloat(parts[1]).toFixed(6);this.latitude=parseFloat(this.FormatNumber(String(this.latitude)));this.longitude=parseFloat(this.FormatNumber(String(this.longitude)));if(this.latitude>90||this.latitude<-90)this.latitude=0;if(this.longitude>180||this.longitude<-180)this.longitude=0}};RFC2426Geo.prototype.Reset=function(){this.latitude=0;this.longitude=0};RFC2426Geo.prototype.toString=function(){return this.latitude+";"+this.longitude};RFC2426Geo.prototype.FormatNumber=function(a){var b=a.indexOf(".");if(b>-1){first=a.substring(0,b);second=a.substring(b,a.length);while(second.charAt(second.length-1)=="0")second=second.substring(0,second.length-1);if(second.length>1)return first+second;else return first}return a}







function js_beautify(a,b){function K(a){a=typeof a==="undefined"?false:a;while(d.length&&(d[d.length-1]===" "||d[d.length-1]===l||d[d.length-1]===y||a&&(d[d.length-1]==="\n"||d[d.length-1]==="\r"))){d.pop()}}function L(a){return a.replace(/^\s\s*|\s\s*$/,"")}function M(a){a=a.replace(/\x0d/g,"");var b=[],c=a.indexOf("\n");while(c!==-1){b.push(a.substring(0,c));a=a.substring(c+1);c=a.indexOf("\n")}if(a.length){b.push(a)}return b}function N(){var a=F;F=false;O();F=a}function O(a){j.eat_next_space=false;if(F&&U(j.mode)){return}a=typeof a==="undefined"?true:a;j.if_line=false;K();if(!d.length){return}if(d[d.length-1]!=="\n"||!a){w=true;d.push("\n")}if(y){d.push(y)}for(var b=0;b<j.indentation_level;b+=1){d.push(l)}if(j.var_line&&j.var_line_reindented){d.push(l)}if(j.case_body){d.push(l)}}function P(){if(f==="TK_COMMENT"){return O()}if(j.eat_next_space){j.eat_next_space=false;return}var a=" ";if(d.length){a=d[d.length-1]}if(a!==" "&&a!=="\n"&&a!==l){d.push(" ")}}function Q(){w=false;j.eat_next_space=false;d.push(e)}function R(){j.indentation_level+=1}function S(){if(d.length&&d[d.length-1]===l){d.pop()}}function T(a){if(j){k.push(j)}j={previous_mode:j?j.mode:"BLOCK",mode:a,var_line:false,var_line_tainted:false,var_line_reindented:false,in_html_comment:false,if_line:false,in_case_statement:false,in_case:false,case_body:false,eat_next_space:false,indentation_baseline:-1,indentation_level:j?j.indentation_level+(j.case_body?1:0)+(j.var_line&&j.var_line_reindented?1:0):0,ternary_depth:0}}function U(a){return a==="[EXPRESSION]"||a==="[INDENTED-EXPRESSION]"}function V(a){return Z(a,["[EXPRESSION]","(EXPRESSION)","(FOR-EXPRESSION)","(COND-EXPRESSION)"])}function W(){u=j.mode==="DO_BLOCK";if(k.length>0){var a=j.mode;j=k.pop();j.previous_mode=a}}function X(a,b){for(var c=0;c<a.length;c++){var d=L(a[c]);if(d.charAt(0)!==b){return false}}return true}function Y(a){return Z(a,["case","return","do","if","throw","else"])}function Z(a,b){for(var c=0;c<b.length;c+=1){if(b[c]===a){return true}}return false}function $(a){var b=p;var d=c.charAt(b);while(Z(d,m)&&d!==a){b++;if(b>=J){return 0}d=c.charAt(b)}return d}function _(){var a;var b;x=0;if(p>=J){return["","TK_EOF"]}v=false;var e=c.charAt(p);p+=1;var h=F&&U(j.mode);if(h){var i=0;while(Z(e,m)){if(e==="\n"){K();d.push("\n");w=true;i=0}else{if(e==="  "){i+=4}else if(e==="\r"){}else{i+=1}}if(p>=J){return["","TK_EOF"]}e=c.charAt(p);p+=1}if(j.indentation_baseline===-1){j.indentation_baseline=i}if(w){for(a=0;a<j.indentation_level+1;a+=1){d.push(l)}if(j.indentation_baseline!==-1){for(a=0;a<i-j.indentation_baseline;a++){d.push(" ")}}}}else{while(Z(e,m)){if(e==="\n"){x+=D?x<=D?1:0:1}if(p>=J){return["","TK_EOF"]}e=c.charAt(p);p+=1}if(C){if(x>1){for(a=0;a<x;a+=1){O(a===0);w=true}}}v=x>0}if(Z(e,n)){if(p<J){while(Z(c.charAt(p),n)){e+=c.charAt(p);p+=1;if(p===J){break}}}if(p!==J&&e.match(/^[0-9]+[Ee]$/)&&(c.charAt(p)==="-"||c.charAt(p)==="+")){var k=c.charAt(p);p+=1;var q=_();e+=k+q[0];return[e,"TK_WORD"]}if(e==="in"){return[e,"TK_OPERATOR"]}if(v&&f!=="TK_OPERATOR"&&f!=="TK_EQUALS"&&!j.if_line&&(C||g!=="var")){O()}return[e,"TK_WORD"]}if(e==="("||e==="["){return[e,"TK_START_EXPR"]}if(e===")"||e==="]"){return[e,"TK_END_EXPR"]}if(e==="{"){return[e,"TK_START_BLOCK"]}if(e==="}"){return[e,"TK_END_BLOCK"]}if(e===";"){return[e,"TK_SEMICOLON"]}if(e==="/"){var s="";var t=true;if(c.charAt(p)==="*"){p+=1;if(p<J){while(p<J&&!(c.charAt(p)==="*"&&c.charAt(p+1)&&c.charAt(p+1)==="/")){e=c.charAt(p);s+=e;if(e==="\n"||e==="\r"){t=false}p+=1;if(p>=J){break}}}p+=2;if(t&&x===0){return["/*"+s+"*/","TK_INLINE_COMMENT"]}else{return["/*"+s+"*/","TK_BLOCK_COMMENT"]}}if(c.charAt(p)==="/"){s=e;while(c.charAt(p)!=="\r"&&c.charAt(p)!=="\n"){s+=c.charAt(p);p+=1;if(p>=J){break}}if(v){O()}return[s,"TK_COMMENT"]}}if(e==="'"||e==='"'||e==="/"&&(f==="TK_WORD"&&Y(g)||g===")"&&Z(j.previous_mode,["(COND-EXPRESSION)","(FOR-EXPRESSION)"])||f==="TK_COMMA"||f==="TK_COMMENT"||f==="TK_START_EXPR"||f==="TK_START_BLOCK"||f==="TK_END_BLOCK"||f==="TK_OPERATOR"||f==="TK_EQUALS"||f==="TK_EOF"||f==="TK_SEMICOLON")){var u=e;var y=false;var z=0;var A=0;b=e;if(p<J){if(u==="/"){var B=false;while(y||B||c.charAt(p)!==u){b+=c.charAt(p);if(!y){y=c.charAt(p)==="\\";if(c.charAt(p)==="["){B=true}else if(c.charAt(p)==="]"){B=false}}else{y=false}p+=1;if(p>=J){return[b,"TK_STRING"]}}}else{while(y||c.charAt(p)!==u){b+=c.charAt(p);if(z&&z>=A){z=parseInt(b.substr(-A),16);if(z&&z>=32&&z<=126){z=String.fromCharCode(z);b=b.substr(0,b.length-A-2)+(z===u||z==="\\"?"\\":"")+z}z=0}if(z){z++}else if(!y){y=c.charAt(p)==="\\"}else{y=false;if(I){if(c.charAt(p)==="x"){z++;A=2}else if(c.charAt(p)==="u"){z++;A=4}}}p+=1;if(p>=J){return[b,"TK_STRING"]}}}}p+=1;b+=u;if(u==="/"){while(p<J&&Z(c.charAt(p),n)){b+=c.charAt(p);p+=1}}return[b,"TK_STRING"]}if(e==="#"){if(d.length===0&&c.charAt(p)==="!"){b=e;while(p<J&&e!=="\n"){e=c.charAt(p);b+=e;p+=1}d.push(L(b)+"\n");O();return _()}var E="#";if(p<J&&Z(c.charAt(p),r)){do{e=c.charAt(p);E+=e;p+=1}while(p<J&&e!=="#"&&e!=="=");if(e==="#"){}else if(c.charAt(p)==="["&&c.charAt(p+1)==="]"){E+="[]";p+=2}else if(c.charAt(p)==="{"&&c.charAt(p+1)==="}"){E+="{}";p+=2}return[E,"TK_WORD"]}}if(e==="<"&&c.substring(p-1,p+3)==="<!--"){p+=3;e="<!--";while(c.charAt(p)!=="\n"&&p<J){e+=c.charAt(p);p++}j.in_html_comment=true;return[e,"TK_COMMENT"]}if(e==="-"&&j.in_html_comment&&c.substring(p-1,p+2)==="-->"){j.in_html_comment=false;p+=2;if(v){O()}return["-->","TK_COMMENT"]}if(Z(e,o)){while(p<J&&Z(e+c.charAt(p),o)){e+=c.charAt(p);p+=1;if(p>=J){break}}if(e===","){return[e,"TK_COMMA"]}else if(e==="="){return[e,"TK_EQUALS"]}else{return[e,"TK_OPERATOR"]}}return[e,"TK_UNKNOWN"]}var c,d,e,f,g,h,i,j,k,l;var m,n,o,p,q,r;var s,t,u;var v,w,x;var y="";b=b?b:{};var z;if(b.space_after_anon_function!==undefined&&b.jslint_happy===undefined){b.jslint_happy=b.space_after_anon_function}if(b.braces_on_own_line!==undefined){z=b.braces_on_own_line?"expand":"collapse"}z=b.brace_style?b.brace_style:z?z:"collapse";var A=b.indent_size?b.indent_size:4;var B=b.indent_char?b.indent_char:" ";var C=typeof b.preserve_newlines==="undefined"?true:b.preserve_newlines;var D=typeof b.max_preserve_newlines==="undefined"?false:b.max_preserve_newlines;var E=b.jslint_happy==="undefined"?false:b.jslint_happy;var F=typeof b.keep_array_indentation==="undefined"?false:b.keep_array_indentation;var G=typeof b.space_before_conditional==="undefined"?true:b.space_before_conditional;var H=typeof b.indent_case==="undefined"?false:b.indent_case;var I=typeof b.unescape_strings==="undefined"?false:b.unescape_strings;w=false;var J=a.length;l="";while(A>0){l+=B;A-=1}while(a&&(a.charAt(0)===" "||a.charAt(0)===" ")){y+=a.charAt(0);a=a.substring(1)}c=a;i="";f="TK_START_EXPR";g="";h="";d=[];u=false;m="\n\r  ".split("");n="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789_$".split("");r="0123456789".split("");o="+ - * / % & ++ -- = += -= *= /= %= == === != !== > < >= <= >> << >>> >>>= >>= <<= && &= | || ! !! , : ? ^ ^= |= ::";o+=" <%= <% %> <?= <? ?>";o=o.split(" ");q="continue,try,throw,return,var,if,switch,case,default,for,while,break,function".split(",");k=[];T("BLOCK");p=0;while(true){var ab=_();e=ab[0];t=ab[1];if(t==="TK_EOF"){break}switch(t){case"TK_START_EXPR":if(e==="["){if(f==="TK_WORD"||g===")"){if(Z(g,q)){P()}T("(EXPRESSION)");Q();break}if(j.mode==="[EXPRESSION]"||j.mode==="[INDENTED-EXPRESSION]"){if(h==="]"&&g===","){if(j.mode==="[EXPRESSION]"){j.mode="[INDENTED-EXPRESSION]";if(!F){R()}}T("[EXPRESSION]");if(!F){O()}}else if(g==="["){if(j.mode==="[EXPRESSION]"){j.mode="[INDENTED-EXPRESSION]";if(!F){R()}}T("[EXPRESSION]");if(!F){O()}}else{T("[EXPRESSION]")}}else{T("[EXPRESSION]")}}else{if(i==="for"){T("(FOR-EXPRESSION)")}else if(Z(i,["if","while"])){T("(COND-EXPRESSION)")}else{T("(EXPRESSION)")}}if(g===";"||f==="TK_START_BLOCK"){O()}else if(f==="TK_END_EXPR"||f==="TK_START_EXPR"||f==="TK_END_BLOCK"||g==="."){if(v){O()}}else if(f!=="TK_WORD"&&f!=="TK_OPERATOR"){P()}else if(i==="function"||i==="typeof"){if(E){P()}}else if(Z(g,q)||g==="catch"){if(G){P()}}Q();break;case"TK_END_EXPR":if(e==="]"){if(F){if(g==="}"){S();Q();W();break}}else{if(j.mode==="[INDENTED-EXPRESSION]"){if(g==="]"){W();O();Q();break}}}}W();Q();break;case"TK_START_BLOCK":if(i==="do"){T("DO_BLOCK")}else{T("BLOCK")}if(z==="expand"||z==="expand-strict"){var bb=false;if(z==="expand-strict"){bb=$()==="}";if(!bb){O(true)}}else{if(f!=="TK_OPERATOR"){if(g==="="||Y(g)&&g!=="else"){P()}else{O(true)}}}Q();if(!bb){R()}}else{if(f!=="TK_OPERATOR"&&f!=="TK_START_EXPR"){if(f==="TK_START_BLOCK"){O()}else{P()}}else{if(U(j.previous_mode)&&g===","){if(h==="}"){P()}else{O()}}}R();Q()}break;case"TK_END_BLOCK":W();if(z==="expand"||z==="expand-strict"){if(g!=="{"){O()}Q()}else{if(f==="TK_START_BLOCK"){if(w){S()}else{K()}}else{if(U(j.mode)&&F){F=false;O();F=true}else{O()}}Q()}break;case"TK_WORD":if(u){P();Q();P();u=false;break}s="NONE";if(e==="function"){if(j.var_line&&f!=="TK_EQUALS"){j.var_line_reindented=true}if((w||g===";")&&g!=="{"&&f!=="TK_BLOCK_COMMENT"&&f!=="TK_COMMENT"){x=w?x:0;if(!C){x=1}for(var cb=0;cb<2-x;cb++){O(false)}}if(f==="TK_WORD"){if(g==="get"||g==="set"||g==="new"||g==="return"){P()}else{O()}}else if(f==="TK_OPERATOR"||g==="="){P()}else if(V(j.mode)){}else{O()}Q();i=e;break}if(e==="case"||e==="default"&&j.in_case_statement){if(g===":"||j.case_body){S()}else{if(!H){j.indentation_level--}O();if(!H){j.indentation_level++}}Q();j.in_case=true;j.in_case_statement=true;j.case_body=false;break}if(f==="TK_END_BLOCK"){if(!Z(e.toLowerCase(),["else","catch","finally"])){s="NEWLINE"}else{if(z==="expand"||z==="end-expand"||z==="expand-strict"){s="NEWLINE"}else{s="SPACE";P()}}}else if(f==="TK_SEMICOLON"&&(j.mode==="BLOCK"||j.mode==="DO_BLOCK")){s="NEWLINE"}else if(f==="TK_SEMICOLON"&&V(j.mode)){s="SPACE"}else if(f==="TK_STRING"){s="NEWLINE"}else if(f==="TK_WORD"){if(g==="else"){K(true)}s="SPACE"}else if(f==="TK_START_BLOCK"){s="NEWLINE"}else if(f==="TK_END_EXPR"){P();s="NEWLINE"}if(Z(e,q)&&g!==")"){if(g==="else"){s="SPACE"}else{s="NEWLINE"}}if(j.if_line&&f==="TK_END_EXPR"){j.if_line=false}if(Z(e.toLowerCase(),["else","catch","finally"])){if(f!=="TK_END_BLOCK"||z==="expand"||z==="end-expand"||z==="expand-strict"){O()}else{K(true);P()}}else if(s==="NEWLINE"){if(Y(g)){P()}else if(f!=="TK_END_EXPR"){if((f!=="TK_START_EXPR"||e!=="var")&&g!==":"){if(e==="if"&&i==="else"&&g!=="{"){P()}else{j.var_line=false;j.var_line_reindented=false;O()}}}else if(Z(e,q)&&g!==")"){j.var_line=false;j.var_line_reindented=false;O()}}else if(U(j.mode)&&g===","&&h==="}"){O()}else if(s==="SPACE"){P()}Q();i=e;if(e==="var"){j.var_line=true;j.var_line_reindented=false;j.var_line_tainted=false}if(e==="if"){j.if_line=true}if(e==="else"){j.if_line=false}break;case"TK_SEMICOLON":Q();j.var_line=false;j.var_line_reindented=false;if(j.mode==="OBJECT"){j.mode="BLOCK"}break;case"TK_STRING":if(f==="TK_END_EXPR"&&Z(j.previous_mode,["(COND-EXPRESSION)","(FOR-EXPRESSION)"])){P()}else if(f==="TK_COMMENT"||f==="TK_STRING"||f==="TK_START_BLOCK"||f==="TK_END_BLOCK"||f==="TK_SEMICOLON"){O()}else if(f==="TK_WORD"){P()}Q();break;case"TK_EQUALS":if(j.var_line){j.var_line_tainted=true}P();Q();P();break;case"TK_COMMA":if(j.var_line){if(V(j.mode)||f==="TK_END_BLOCK"){j.var_line_tainted=false}if(j.var_line_tainted){Q();j.var_line_reindented=true;j.var_line_tainted=false;O();break}else{j.var_line_tainted=false}Q();P();break}if(f==="TK_COMMENT"){O()}if(f==="TK_END_BLOCK"&&j.mode!=="(EXPRESSION)"){Q();if(j.mode==="OBJECT"&&g==="}"){O()}else{P()}}else{if(j.mode==="OBJECT"){Q();O()}else{Q();P()}}break;case"TK_OPERATOR":var db=true;var eb=true;if(Y(g)){P();Q();break}if(e==="*"&&f==="TK_UNKNOWN"&&!h.match(/^\d+$/)){Q();break}if(e===":"&&j.in_case){if(H){j.case_body=true}Q();O();j.in_case=false;break}if(e==="::"){Q();break}if(Z(e,["--","++","!"])||Z(e,["-","+"])&&(Z(f,["TK_START_BLOCK","TK_START_EXPR","TK_EQUALS","TK_OPERATOR"])||Z(g,q))){db=false;eb=false;if(g===";"&&V(j.mode)){db=true}if(f==="TK_WORD"&&Z(g,q)){db=true}if(j.mode==="BLOCK"&&(g==="{"||g===";")){O()}}else if(e==="."){db=false}else if(e===":"){if(j.ternary_depth===0){if(j.mode==="BLOCK"){j.mode="OBJECT"}db=false}else{j.ternary_depth-=1}}else if(e==="?"){j.ternary_depth+=1}if(db){P()}Q();if(eb){P()}break;case"TK_BLOCK_COMMENT":var fb=M(e);var gb;if(X(fb.slice(1),"*")){O();d.push(fb[0]);for(gb=1;gb<fb.length;gb++){O();d.push(" ");d.push(L(fb[gb]))}}else{if(fb.length>1){O()}else{if(f==="TK_END_BLOCK"){O()}else{P()}}for(gb=0;gb<fb.length;gb++){d.push(fb[gb]);d.push("\n")}}if($("\n")!=="\n"){O()}break;case"TK_INLINE_COMMENT":P();Q();if(V(j.mode)){P()}else{N()}break;case"TK_COMMENT":if(g===","&&!v){K(true)}if(f!=="TK_COMMENT"){if(v){O()}else{P()}}Q();O();break;case"TK_UNKNOWN":if(Y(g)){P()}Q();break}h=g;f=t;g=e}var hb=y+d.join("").replace(/[\r\n ]+$/,"");return hb}if(typeof exports!=="undefined"){exports.js_beautify=js_beautify}



</script>
 
   
</head>
<body>

<h1>Unit Tests - microformat-node</h1>  
<p class="notes">These tests are shared across a number of parsers, although microformat-node will pass most there are still some tests it fails.</p>
    
    <div class="clearfix">
    <ul id="tests"></ul>
    <section id="results"></section>
    </div>
    
     <footer class="vcard">
        <p class="copyright">© Copyright <a rel="me" href="http://www.glennjones.net" class="fn url">Glenn Jones</a> 2012. All Rights Reserved.</p>
    </footer>
    
  </body>
</html>
